RewriteEngine On

# Force HTTPS - SSL Actif
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# CORS Headers pour Vercel - Configuration Dynamique via PHP
<IfModule mod_headers.c>
    # Les headers CORS sont gérés dynamiquement par config.php
    # Cela permet de supporter à la fois localhost (dev) et Vercel (prod)
    # URL Vercel: https://gamezoneismo.vercel.app
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, X-CSRF-Token"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Security - Proteger les fichiers sensibles
<FilesMatch "^\.env">
    Order allow,deny
    Deny from all
</FilesMatch>

<FilesMatch "\.(sql|md|txt)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Redirect HTTP to API
DirectoryIndex index.php index.html

# Enable error display for debugging (DESACTIVER EN PRODUCTION)
php_flag display_errors Off
php_flag log_errors On

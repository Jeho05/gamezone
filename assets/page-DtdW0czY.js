import{r as m,d as W,i as Z}from"./react-vendor-DYp0RFF0.js";import{j as e}from"./ui-vendor-DAbCkwHz.js";import{R as ee}from"./layout-BhjoAR2P.js";import{C as r}from"./PolymorphicComponent-kLkD8TKY.js";import{N as re,Q as se}from"./Navigation-KwyceX57.js";import{C as M}from"./camera-DYh6bjNE.js";import{C as D}from"./circle-x-3yZKVann.js";import{T as Y}from"./triangle-alert-DENqbV0K.js";import{A as U}from"./apiBase-uKT1-15E.js";import{t as d}from"./index-ISQCChad.js";import{c as B}from"./createLucideIcon-BuqtEc0O.js";import{R as L}from"./refresh-cw-3nrt7UJ1.js";import{C as k}from"./circle-check-big-cyHuzEaZ.js";import{P as $}from"./play-ErchTkYN.js";import{T as ne}from"./timer-CkL3-bfF.js";import{C as te}from"./clock-CG-fk9kX.js";import{P as ae}from"./pause-BthwcmCB.js";import"./index-Birp5Yjg.js";import"./gamepad-DUfdRHsM.js";import"./users-CFhMAaaJ.js";import"./star-COodYRQY.js";import"./sparkles-CYj8vm4n.js";import"./trophy-i2KwZb7z.js";import"./x-B8NaV6qa.js";if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}const de=B("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]);if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}const ie=B("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}const oe=B("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}const ce=B("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}function le({onScan:c,onClose:u}){const n=m.useRef(null),t=m.useRef(null),[g,I]=m.useState(null),[p,N]=m.useState(!1),w=m.useRef(null);m.useEffect(()=>(T(),()=>{P()}),[]);const T=async()=>{try{const x=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});w.current=x,n.current&&(n.current.srcObject=x,n.current.play(),N(!0),requestAnimationFrame(C))}catch(x){console.error("Erreur caméra:",x),I("Impossible d'accéder à la caméra. Vérifiez les permissions.")}},P=()=>{w.current&&(w.current.getTracks().forEach(x=>x.stop()),w.current=null),N(!1)},C=()=>{if(!p||!n.current||!t.current)return;const x=n.current,b=t.current,y=b.getContext("2d");if(x.readyState===x.HAVE_ENOUGH_DATA){b.height=x.videoHeight,b.width=x.videoWidth,y.drawImage(x,0,0,b.width,b.height);const j=y.getImageData(0,0,b.width,b.height);if(typeof window<"u"&&window.jsQR){const S=window.jsQR(j.data,j.width,j.height,{inversionAttempts:"dontInvert"});if(S&&S.data){P(),c(S.data);return}}else window.jsQR||console.warn("jsQR not loaded yet")}p&&requestAnimationFrame(C)},v=()=>{P(),u()};return e.jsx(r,{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",renderId:"render-4e7c8a60",as:"div",children:e.jsxs(r,{className:"bg-white rounded-2xl max-w-2xl w-full overflow-hidden",renderId:"render-e96476bb",as:"div",children:[e.jsxs(r,{className:"bg-gradient-to-r from-purple-600 to-indigo-600 p-6 flex justify-between items-center",renderId:"render-450e0cb1",as:"div",children:[e.jsxs(r,{className:"text-2xl font-bold text-white flex items-center gap-2",renderId:"render-bb19f142",as:"h2",children:[e.jsx(M,{className:"w-6 h-6"}),"Scanner QR Code"]}),e.jsx(r,{onClick:v,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-all",renderId:"render-19717b82",as:"button",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsx(r,{className:"p-6",renderId:"render-f54f7680",as:"div",children:g?e.jsxs(r,{className:"bg-red-50 border-2 border-red-200 rounded-xl p-6 text-center",renderId:"render-c29a84b9",as:"div",children:[e.jsx(Y,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx(r,{className:"text-xl font-bold text-red-800 mb-2",renderId:"render-dd5852e2",as:"h3",children:"Erreur Caméra"}),e.jsx(r,{className:"text-red-600 mb-4",renderId:"render-eccd590c",as:"p",children:g}),e.jsx(r,{onClick:v,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold",renderId:"render-08f260d9",as:"button",children:"Fermer"})]}):e.jsxs(r,{className:"space-y-4",renderId:"render-623f821a",as:"div",children:[e.jsxs(r,{className:"relative bg-black rounded-xl overflow-hidden",renderId:"render-1f8fe5e3",as:"div",children:[e.jsx("video",{ref:n,className:"w-full h-auto",playsInline:!0,muted:!0}),e.jsx(r,{className:"absolute inset-0 flex items-center justify-center pointer-events-none",renderId:"render-63a352f3",as:"div",children:e.jsxs(r,{className:"w-64 h-64 border-4 border-white/50 rounded-xl shadow-lg",renderId:"render-95c23d31",as:"div",children:[e.jsx(r,{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-green-400 rounded-tl-xl",renderId:"render-7771356d",as:"div"}),e.jsx(r,{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-green-400 rounded-tr-xl",renderId:"render-cd7e3e55",as:"div"}),e.jsx(r,{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-green-400 rounded-bl-xl",renderId:"render-b178eaf2",as:"div"}),e.jsx(r,{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-green-400 rounded-br-xl",renderId:"render-f6de863e",as:"div"})]})}),e.jsx("canvas",{ref:t,className:"hidden"})]}),e.jsxs(r,{className:"text-center space-y-2",renderId:"render-339b440f",as:"div",children:[e.jsxs(r,{className:"flex items-center justify-center gap-2 text-gray-600",renderId:"render-18e81613",as:"div",children:[e.jsx(r,{className:"animate-pulse w-3 h-3 bg-green-500 rounded-full",renderId:"render-c4d8c08a",as:"div"}),e.jsx(r,{className:"font-semibold",renderId:"render-1172c50e",as:"span",children:"Positionnez le QR code dans le cadre"})]}),e.jsx(r,{className:"text-sm text-gray-500",renderId:"render-975c4213",as:"p",children:"Le code sera scanné automatiquement"})]}),e.jsx(r,{onClick:v,className:"w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold",renderId:"render-9cbc1d82",as:"button",children:"Annuler"})]})})]})})}if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}function ue(){const[c,u]=m.useState(""),[n,t]=m.useState(!1),[g,I]=m.useState(null),[p,N]=m.useState(null),[w,T]=m.useState([]),[P,C]=m.useState(!1),[v,x]=m.useState(0),[b,y]=m.useState(null),[j,S]=m.useState("online"),[A,z]=m.useState(null),E=W.useMemo(()=>A&&typeof A.progress_percent=="number"&&A.progress_percent>=100?"completed":p?.session_status,[p?.session_status,A?.progress_percent]);m.useEffect(()=>{const s=localStorage.getItem("scan_history");s&&T(JSON.parse(s))},[]),m.useEffect(()=>{const s=()=>{S("online"),d.success("Connexion rétablie",{duration:2e3})},l=()=>{S("offline"),d.error("⚠️ Connexion perdue! Vérifiez votre réseau.",{duration:5e3})};return window.addEventListener("online",s),window.addEventListener("offline",l),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",l)}},[]);const R=(s,l,i=null)=>{const a={code:s,status:l,error:i,timestamp:new Date().toISOString()};T(f=>{const h=[a,...Array.isArray(f)?f:[]].slice(0,10);return localStorage.setItem("scan_history",JSON.stringify(h)),h})},O=(s,l)=>{const i=s.error||"unknown",f={invalid_code:{title:"Code Invalide",message:"Ce code de validation n'existe pas",icon:"❌",canRetry:!1,solution:"Vérifiez le code et réessayez"},already_active:{title:"Déjà Activée",message:"Cette facture a déjà été activée",icon:"⚠️",canRetry:!1,solution:"Utilisez un nouveau code QR"},already_used:{title:"Déjà Utilisée",message:"Cette facture a déjà été utilisée",icon:"🔒",canRetry:!1,solution:"Cette facture ne peut plus être utilisée"},already_cancelled:{title:"Annulée",message:"Cette facture a été annulée",icon:"🚫",canRetry:!1,solution:"Contactez l'administration"},expired:{title:"Expirée",message:"Cette facture a expiré (validité 2 mois)",icon:"⏰",canRetry:!1,solution:"Facture trop ancienne, créez un nouvel achat"},fraud_detected:{title:"Fraude Détectée",message:"Activité suspecte - Facture bloquée",icon:"🚨",canRetry:!1,solution:"Contactez immédiatement l'administration"},too_early:{title:"Trop Tôt",message:s.message||"La session ne peut pas encore être activée",icon:"⏱️",canRetry:!0,solution:`Réessayez dans ${s.minutes_until_start||"?"} minutes`},payment_pending:{title:"Paiement En Attente",message:"Le paiement n'a pas encore été confirmé",icon:"💳",canRetry:!0,solution:"Confirmez le paiement d'abord dans Gestion Boutique"},payment_failed:{title:"Paiement Échoué",message:"Le paiement a échoué ou a été refusé",icon:"❌",canRetry:!1,solution:"Créez un nouvel achat avec un nouveau paiement"},session_creation_failed:{title:"Erreur Technique",message:"Impossible de créer la session",icon:"⚙️",canRetry:!0,solution:"Réessayez dans quelques instants"}}[i]||{title:"Erreur",message:s.message||"Une erreur est survenue",icon:"❌",canRetry:!1,solution:"Contactez le support technique"};d.error(`${f.icon} ${f.title}`,{description:f.message,duration:5e3}),I({type:"error",message:f.message,title:f.title,error:i,canRetry:f.canRetry,solution:f.solution,minutes_until_start:s.minutes_until_start,scheduled_start:s.scheduled_start,scheduled_end:s.scheduled_end}),y({type:"business",code:i,...f}),R(l,"error",i)},F=(s,l,i)=>{console.error("Technical Error:",s);let a="unknown",f="Erreur inconnue",h=!0,o="Réessayez dans quelques instants";s.name==="AbortError"?(a="timeout",f="Délai d'attente dépassé (15s)",o="Le serveur met trop de temps à répondre. Vérifiez votre connexion.",d.error("⏱️ Timeout: Le serveur ne répond pas",{duration:5e3})):s.message.includes("Failed to fetch")||s.message.includes("NetworkError")?(a="network",f="Erreur de connexion réseau",o="Vérifiez votre connexion internet et réessayez",d.error("📡 Erreur réseau: Impossible de se connecter au serveur",{duration:5e3})):s.message.includes("500")?(a="server",f="Erreur serveur (500)",o="Le serveur rencontre un problème. Réessayez dans 1 minute.",d.error("🔧 Erreur serveur: Service temporairement indisponible",{duration:5e3})):d.error(`❌ Erreur: ${s.message}`,{duration:5e3}),I({type:"error",message:f,error:a,canRetry:h,solution:o}),y({type:"technical",errorType:a,message:f,solution:o,canRetry:h,fullError:s.message}),R(l,"error",a),!i&&v<3&&(a==="network"||a==="timeout")&&(x(_=>_+1),d.info(`🔄 Nouvelle tentative (${v+1}/3)...`,{duration:3e3}),setTimeout(()=>{X(l,!0)},2e3))},X=m.useCallback(async(s,l=!1)=>{if(!s||s.trim().length===0){d.error("⚠️ Veuillez entrer un code valide");return}if(j==="offline"){d.error("❌ Pas de connexion internet. Impossible de scanner.",{duration:4e3}),y({type:"network",message:"Connexion internet perdue",solution:"Vérifiez votre connexion et réessayez"});return}const i=s.trim().toUpperCase().replace(/[-\s]/g,"");if(!/^[A-Z0-9]{8}$/.test(i)&&!/^[A-Z0-9]{16}$/.test(i)){d.error("❌ Format invalide. Le code doit contenir 8 ou 16 caractères.",{duration:4e3}),I({type:"error",message:"Format de code invalide (8 ou 16 caractères requis)",error:"invalid_format"});return}try{t(!0),I(null),y(null);const a=new AbortController,f=setTimeout(()=>a.abort(),15e3),h=await fetch(`${U}/admin/scan_invoice.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({validation_code:i}),signal:a.signal});clearTimeout(f);let o;try{const _=await h.text();console.log("Response status:",h.status),console.log("Response text:",_),o=JSON.parse(_)}catch(_){throw console.error("Parse error:",_),new Error("Réponse serveur invalide")}if(!h.ok){if(h.status===401){d.error("❌ Session expirée. Veuillez vous reconnecter.",{duration:5e3}),y({type:"auth",message:"Session expirée",solution:"Reconnectez-vous et réessayez"}),setTimeout(()=>{window.location.href="/admin/login"},2e3);return}if(h.status===400){console.log("API error 400:",o),console.log("Error code:",o.error),console.log("Error message:",o.message),console.log("Debug info:",o.debug_info),d.error(`❌ ${o.message||"Erreur lors de l'activation"}`,{description:o.debug_info?`Code erreur: ${o.debug_info}`:void 0,duration:6e3}),O(o,i),R(i,"error",o.error||"bad_request");return}throw h.status===500?new Error("Erreur serveur. Réessayez dans quelques instants."):new Error(`Erreur HTTP ${h.status}`)}o.success?(I({type:"success",data:o}),N(o.invoice),x(0),o.next_action==="session_started"||o.invoice?.session_status==="active"?(d.success("✅ Facture Activée !",{duration:3e3}),d.success("🎮 Session démarrée automatiquement",{duration:4e3}),d.info("✨ Le joueur peut commencer à jouer immédiatement",{duration:5e3,description:`${o.invoice.game_name} - ${o.invoice.duration_minutes} minutes`})):(d.success("✅ Facture activée avec succès !",{duration:3e3}),d.warning("⚠️ La session doit être démarrée manuellement",{duration:4e3})),R(i,"success"),u("")):O(o,i)}catch(a){F(a,i,l)}finally{t(!1)}},[j,v]),V=async s=>{s?.preventDefault(),X(c)},Q=()=>{c?(x(0),X(c)):d.warning("Veuillez entrer un code avant de réessayer")},H=()=>{u(""),I(null),N(null),y(null),x(0)},J=s=>{u(s),X(s),C(!1)},K=m.useCallback(async()=>{if(p?.session_id)try{const s=await fetch(`${U}/admin/manage_session.php?id=${p.session_id}`,{method:"GET",credentials:"include"});if(!s.ok){if(s.status===401){d.error("Session expirée. Veuillez vous reconnecter.",{duration:4e3}),setTimeout(()=>{window.location.href="/admin/login"},1500);return}return}const l=await s.json();l?.session&&z(l.session)}catch{}},[p?.session_id]);m.useEffect(()=>{p?.session_id?K():z(null)},[p?.session_id,K]);const q=async s=>{if(!p?.session_id){d.error("Aucune session à contrôler");return}try{t(!0);const l=await fetch(`${U}/admin/manage_session.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:p.session_id,action:s})}),i=await l.json();if(!l.ok||!i.success){d.error(i?.error||"Action impossible");return}s==="pause"?(d.success("Session mise en pause"),N(a=>a&&{...a,session_status:"paused"})):s==="resume"&&(d.success("Session reprise"),N(a=>a&&{...a,session_status:"active"})),await K()}catch{d.error("Erreur lors de l'action")}finally{t(!1)}},G=s=>{const l={success:{icon:k,bg:"bg-green-600",text:"Succès"},error:{icon:D,bg:"bg-red-600",text:"Échec"}},i=l[s]||l.error,a=i.icon;return e.jsxs(r,{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold text-white ${i.bg}`,renderId:"render-3539b367",as:"span",children:[e.jsx(a,{className:"w-3 h-3"}),i.text]})};return e.jsxs(r,{className:"min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900",renderId:"render-ea7c51cd",as:"div",children:[e.jsx(re,{userType:"admin"}),e.jsx(r,{className:"lg:pl-64",renderId:"render-3fc198f5",as:"div",children:e.jsxs(r,{className:"container mx-auto px-4 py-8",renderId:"render-8d00169e",as:"div",children:[e.jsxs(r,{className:"bg-white rounded-xl shadow-lg p-6 mb-6",renderId:"render-bd55eb05",as:"div",children:[e.jsxs(r,{className:"flex items-center justify-between mb-2",renderId:"render-1f09ddfe",as:"div",children:[e.jsxs(r,{className:"flex items-center gap-3",renderId:"render-2fa767ce",as:"div",children:[e.jsx(se,{className:"w-8 h-8 text-purple-600"}),e.jsx(r,{className:"text-3xl font-bold text-purple-600",renderId:"render-fe708fc4",as:"h1",children:"Scanner de Factures"})]}),j==="offline"&&e.jsxs(r,{className:"flex items-center gap-2 px-3 py-2 bg-red-100 text-red-700 rounded-lg",renderId:"render-601de639",as:"div",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx(r,{className:"text-sm font-semibold",renderId:"render-37d70761",as:"span",children:"Hors ligne"})]})]}),e.jsx(r,{className:"text-gray-600",renderId:"render-b7585b8e",as:"p",children:"Scannez ou entrez le code de validation pour activer une facture"})]}),e.jsxs(r,{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",renderId:"render-d65c5d81",as:"div",children:[e.jsxs(r,{className:"bg-white rounded-xl shadow-lg p-6",renderId:"render-40159879",as:"div",children:[e.jsxs(r,{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",renderId:"render-c4f10c69",as:"h2",children:[e.jsx(oe,{className:"w-6 h-6"}),"Scanner"]}),e.jsxs(r,{onSubmit:V,className:"space-y-4",renderId:"render-6f4233ef",as:"form",children:[e.jsxs(r,{renderId:"render-3837c1cb",as:"div",children:[e.jsx(r,{className:"block text-sm font-semibold text-gray-700 mb-2",renderId:"render-d4725a54",as:"label",children:"Code de Validation (8 ou 16 caractères)"}),e.jsx(r,{type:"text",value:c,onChange:s=>u(s.target.value.toUpperCase()),placeholder:"XXXX-XXXX-XXXX-XXXX ou XXXX-XXXX",maxLength:19,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-lg",disabled:n||j==="offline",renderId:"render-4859e092",as:"input"}),e.jsxs(r,{className:"mt-1 text-xs text-gray-500",renderId:"render-199ff6b9",as:"p",children:[c.replace(/-/g,"").length," caractères (sans tirets)"]})]}),e.jsxs(r,{className:"flex gap-3",renderId:"render-f165fccf",as:"div",children:[e.jsx(r,{type:"submit",disabled:n||!c||j==="offline",className:"flex-1 py-3 px-4 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",renderId:"render-57cef80d",as:"button",children:n?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 animate-spin"}),"Scan en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5"}),"Valider"]})}),e.jsxs(r,{type:"button",onClick:()=>C(!0),disabled:n||j==="offline",className:"py-3 px-4 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",renderId:"render-613c8917",as:"button",children:[e.jsx(M,{className:"w-5 h-5"}),"QR"]})]})]}),e.jsxs(r,{className:"mt-6",renderId:"render-70fdefe1",as:"div",children:[n&&e.jsxs(r,{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6 text-center",renderId:"render-51715b89",as:"div",children:[e.jsx(L,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-3"}),e.jsx(r,{className:"text-blue-800 font-semibold",renderId:"render-7fb1c8fe",as:"p",children:"Vérification en cours..."}),e.jsx(r,{className:"text-blue-600 text-sm mt-1",renderId:"render-d5a5892f",as:"p",children:"Veuillez patienter"})]}),g?.type==="success"&&p&&e.jsxs(r,{className:"space-y-4",renderId:"render-fd40da14",as:"div",children:[e.jsxs(r,{className:"bg-green-50 border-2 border-green-300 rounded-lg p-4",renderId:"render-672cfb35",as:"div",children:[e.jsxs(r,{className:"flex items-center gap-3 mb-3",renderId:"render-7e05de6a",as:"div",children:[e.jsx(k,{className:"w-6 h-6 text-green-600"}),e.jsx(r,{className:"font-bold text-green-800",renderId:"render-5b91592b",as:"h3",children:"✅ Facture Validée"})]}),e.jsxs(r,{className:"space-y-2 text-sm",renderId:"render-4bfc31f3",as:"div",children:[e.jsxs(r,{className:"flex justify-between",renderId:"render-d91f823f",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-c69a869d",as:"span",children:"Facture:"}),e.jsx(r,{className:"font-mono font-semibold",renderId:"render-9409e416",as:"span",children:p.invoice_number})]}),e.jsxs(r,{className:"flex justify-between",renderId:"render-900eaf58",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-e1939756",as:"span",children:"Joueur:"}),e.jsx(r,{className:"font-semibold",renderId:"render-2f064be0",as:"span",children:p.username})]}),e.jsxs(r,{className:"flex justify-between",renderId:"render-a34d8e92",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-ba51321e",as:"span",children:"Jeu:"}),e.jsx(r,{className:"font-semibold",renderId:"render-dd96fbc9",as:"span",children:p.game_name})]}),e.jsxs(r,{className:"flex justify-between",renderId:"render-86175297",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-2c920ab7",as:"span",children:"Durée:"}),e.jsxs(r,{className:"font-semibold",renderId:"render-4637cd1c",as:"span",children:[p.duration_minutes," minutes"]})]}),typeof A?.progress_percent=="number"&&e.jsxs(r,{className:"flex justify-between",renderId:"render-af56ec7f",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-305fb1f5",as:"span",children:"Progression:"}),e.jsxs(r,{className:"font-semibold",renderId:"render-2497483d",as:"span",children:[A.progress_percent,"%"]})]})]})]}),E==="active"&&e.jsx(r,{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg",renderId:"render-5c7f6e2f",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-fab1b6bf",as:"div",children:[e.jsx(r,{className:"bg-white/20 p-3 rounded-full",renderId:"render-2c9047e3",as:"div",children:e.jsx($,{className:"w-8 h-8"})}),e.jsxs(r,{className:"flex-1",renderId:"render-02abfe45",as:"div",children:[e.jsx(r,{className:"text-xl font-bold mb-2",renderId:"render-734a7cc4",as:"h3",children:"🎮 Session Démarrée"}),e.jsxs(r,{className:"text-green-50 text-sm mb-3",renderId:"render-10a7ee8c",as:"p",children:["La session a été activée et démarrée ",e.jsx(r,{renderId:"render-3f0e4bf9",as:"strong",children:"automatiquement"}),". Le joueur peut commencer à jouer immédiatement."]}),e.jsx(r,{className:"bg-white/10 rounded-lg p-3 text-sm",renderId:"render-7c9a6d41",as:"div",children:e.jsxs(r,{className:"flex items-center gap-2",renderId:"render-c3674f98",as:"div",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs(r,{renderId:"render-652a8535",as:"span",children:[p.total_minutes," minutes disponibles"]})]})})]})]})}),E==="ready"&&e.jsx(r,{className:"bg-yellow-50 border-2 border-yellow-400 rounded-xl p-6",renderId:"render-26ddd133",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-2b7389d6",as:"div",children:[e.jsx(Y,{className:"w-8 h-8 text-yellow-600"}),e.jsxs(r,{renderId:"render-045c7220",as:"div",children:[e.jsx(r,{className:"font-bold text-yellow-800 mb-2",renderId:"render-ad57ef13",as:"h3",children:"⚠️ Session Non Démarrée"}),e.jsx(r,{className:"text-yellow-700 text-sm mb-3",renderId:"render-95100278",as:"p",children:"La facture est activée mais la session n'a pas démarré automatiquement."}),e.jsxs(r,{className:"text-yellow-600 text-xs bg-yellow-100 p-2 rounded",renderId:"render-7377986e",as:"p",children:[e.jsx(r,{renderId:"render-01e976de",as:"strong",children:"Action:"}),' Allez dans "Gestion Sessions" et démarrez la session manuellement']})]})]})}),E==="paused"&&e.jsx(r,{className:"bg-orange-50 border-2 border-orange-400 rounded-xl p-6",renderId:"render-ec705b76",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-c8d5a85b",as:"div",children:[e.jsx(te,{className:"w-8 h-8 text-orange-600"}),e.jsxs(r,{renderId:"render-5c7ed463",as:"div",children:[e.jsx(r,{className:"font-bold text-orange-800 mb-2",renderId:"render-ad7697e3",as:"h3",children:"⏸️ Session en pause"}),e.jsx(r,{className:"text-orange-700 text-sm mb-1",renderId:"render-b11aa61c",as:"p",children:"Reprenez la session quand vous êtes prêt."})]})]})}),E==="completed"&&e.jsx(r,{className:"bg-gray-50 border-2 border-gray-300 rounded-xl p-6",renderId:"render-5fcfc1cf",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-0b6186a5",as:"div",children:[e.jsx(k,{className:"w-8 h-8 text-gray-700"}),e.jsxs(r,{renderId:"render-b02373f0",as:"div",children:[e.jsx(r,{className:"font-bold text-gray-800 mb-2",renderId:"render-a1703f95",as:"h3",children:"✅ Session Terminée"}),e.jsx(r,{className:"text-gray-700 text-sm",renderId:"render-c474bc81",as:"p",children:"Progression 100%. Aucune action requise."})]})]})}),e.jsxs(r,{className:"flex flex-wrap gap-3",renderId:"render-44a2e8b1",as:"div",children:[E==="active"&&e.jsxs(r,{onClick:()=>q("pause"),disabled:n,className:"py-3 px-4 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 disabled:opacity-50 flex items-center gap-2",renderId:"render-cb2d48c5",as:"button",children:[e.jsx(ae,{className:"w-5 h-5"}),"Mettre en pause"]}),E==="paused"&&e.jsxs(r,{onClick:()=>q("resume"),disabled:n,className:"py-3 px-4 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",renderId:"render-a3dcfe82",as:"button",children:[e.jsx($,{className:"w-5 h-5"}),"Reprendre"]}),e.jsxs(r,{onClick:()=>{d.info("Affichage arrêté. La session continue en arrière-plan.",{duration:3e3}),I(null),y(null),z(null),N(s=>s&&{...s})},className:"py-3 px-4 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 flex items-center gap-2",renderId:"render-6b7ffdc4",as:"button",children:[e.jsx(de,{className:"w-5 h-5"}),"Arrêter l'affichage"]})]})]}),g?.type==="error"&&b&&e.jsx(r,{className:"bg-red-50 border-2 border-red-300 rounded-xl p-6",renderId:"render-a53a8712",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-5a4ba6e0",as:"div",children:[e.jsx(r,{className:"bg-red-500 p-3 rounded-full flex-shrink-0",renderId:"render-434d4f3e",as:"div",children:e.jsx(D,{className:"w-8 h-8 text-white"})}),e.jsxs(r,{className:"flex-1",renderId:"render-2a8df399",as:"div",children:[e.jsx(r,{className:"text-xl font-bold text-red-800 mb-2",renderId:"render-026bcf78",as:"h3",children:g.title||"Erreur"}),e.jsx(r,{className:"text-red-700 mb-4",renderId:"render-2db99500",as:"p",children:g.message}),g.solution&&e.jsxs(r,{className:"bg-red-100 border border-red-300 rounded-lg p-4 mb-4",renderId:"render-c62ffa1e",as:"div",children:[e.jsx(r,{className:"text-sm font-semibold text-red-800 mb-2",renderId:"render-60948c48",as:"p",children:"💡 Solution:"}),e.jsx(r,{className:"text-sm text-red-700",renderId:"render-f5f7218e",as:"p",children:g.solution})]}),b.type==="technical"&&e.jsxs(r,{className:"mt-3",renderId:"render-b742bd66",as:"details",children:[e.jsx(r,{className:"text-sm text-red-600 cursor-pointer hover:text-red-800 font-semibold",renderId:"render-afe123ab",as:"summary",children:"Détails techniques ▼"}),e.jsxs(r,{className:"mt-2 bg-red-100 p-3 rounded text-xs font-mono text-red-800 space-y-1",renderId:"render-61726799",as:"div",children:[e.jsxs(r,{renderId:"render-efec5da3",as:"p",children:[e.jsx(r,{renderId:"render-49850668",as:"strong",children:"Type:"})," ",b.errorType]}),e.jsxs(r,{renderId:"render-73d59c1b",as:"p",children:[e.jsx(r,{renderId:"render-85ea0562",as:"strong",children:"Message:"})," ",b.fullError]}),v>0&&e.jsxs(r,{renderId:"render-14a3699c",as:"p",children:[e.jsx(r,{renderId:"render-e5379102",as:"strong",children:"Tentatives:"})," ",v,"/3"]})]})]}),g.canRetry&&e.jsxs(r,{onClick:Q,disabled:n,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center gap-2 font-semibold transition-colors",renderId:"render-09725ae9",as:"button",children:[e.jsx(L,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Réessayer"]})]})]})}),g&&e.jsxs(r,{onClick:H,className:"w-full mt-4 py-3 px-4 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 flex items-center justify-center gap-2",renderId:"render-70a47aed",as:"button",children:[e.jsx(L,{className:"w-5 h-5"}),"Scanner un Autre Code"]})]})]}),e.jsxs(r,{className:"bg-white rounded-xl shadow-lg p-6",renderId:"render-83481ef6",as:"div",children:[e.jsxs(r,{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",renderId:"render-68050a65",as:"h2",children:[e.jsx(ie,{className:"w-6 h-6"}),"Historique des Scans"]}),w.length===0?e.jsx(r,{className:"text-gray-500 text-center py-8",renderId:"render-c9599149",as:"p",children:"Aucun scan pour le moment"}):e.jsx(r,{className:"space-y-2",renderId:"render-bd06df01",as:"div",children:w.map((s,l)=>e.jsxs(r,{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",renderId:"render-81a0ebce",as:"div",children:[e.jsxs(r,{className:"flex justify-between items-center",renderId:"render-f83c36f5",as:"div",children:[e.jsx(r,{className:"font-mono text-sm",renderId:"render-79270c88",as:"span",children:s.code}),G(s.status)]}),e.jsxs(r,{className:"text-xs text-gray-500 mt-1",renderId:"render-18f044de",as:"div",children:[new Date(s.timestamp).toLocaleString("fr-FR"),s.error&&e.jsxs(r,{className:"ml-2 text-red-600",renderId:"render-2d712419",as:"span",children:["(",s.error,")"]})]})]},l))})]})]})]})}),P&&e.jsx(le,{onDetected:J,onClose:()=>C(!1)})]})}if(typeof window<"u"){const c={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const u=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},c,u),{get(n,t){return t in n?n[t]:void 0},has(){return!0}})}const Be=Z(function(u){return e.jsx(ee,{children:e.jsx(ue,{...u})})});export{Be as default};

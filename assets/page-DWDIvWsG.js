import{u as B,r as m,i as U}from"./react-vendor-DYp0RFF0.js";import{j as e}from"./ui-vendor-DAbCkwHz.js";import{R as K}from"./layout-BhjoAR2P.js";import{C as r}from"./PolymorphicComponent-kLkD8TKY.js";import{A as j}from"./apiBase-uKT1-15E.js";import{u as V,r as O,i as X,g as M,M as D}from"./gameImageUrl-8jMzVIya.js";import{t as b}from"./index-ISQCChad.js";import"./index-Birp5Yjg.js";import"./style-BfLFPBZc.js";import"./createLucideIcon-BuqtEc0O.js";import"./info-CanGja3Q.js";import"./triangle-alert-DENqbV0K.js";import"./circle-x-3yZKVann.js";import"./circle-check-big-cyHuzEaZ.js";import"./x-B8NaV6qa.js";if(typeof window<"u"){const t={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const x=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},t,x),{get(u,d){return d in u?u[d]:void 0},has(){return!0}})}function Y(){const t=B(),[x,u]=m.useState(null),[d,w]=m.useState([]),[c,y]=m.useState(0),[P,I]=m.useState(!0),[G,C]=m.useState(null),[g,_]=m.useState(!1),[p,$]=m.useState("all"),{modalState:l,hideModal:A,showSuccess:T,showError:h,showConfirm:S}=V();m.useEffect(()=>{E()},[]);const E=async()=>{try{const n=await(await fetch(`${j}/auth/check.php`,{credentials:"include"})).json();if(!n.authenticated||n.user?.role!=="player"){t("/auth/login");return}u(n.user),v()}catch(s){console.error("Erreur auth:",s),t("/auth/login")}},v=async()=>{try{I(!0);const n=await(await fetch(`${j}/shop/redeem_with_points.php`,{credentials:"include"})).json();n.packages&&(w(n.packages),y(n.user_points||0))}catch(s){console.error("Erreur lors du chargement des récompenses:",s)}finally{I(!1)}},R=s=>{if(c<s.points_cost){h("Points Insuffisants",`Vous avez ${c} points, il vous en faut ${s.points_cost}.

Il vous manque ${s.points_cost-c} points.`);return}if(s.max_purchases_per_user&&s.user_purchases_count>=s.max_purchases_per_user){h("Limite Atteinte",`Vous avez déjà acheté cette récompense ${s.user_purchases_count} fois.

Limite maximale: ${s.max_purchases_per_user} achats par utilisateur.`);return}S("🎁 Confirmer l'Échange",`Échanger ${s.points_cost} points contre:

🎮 ${s.game_name}
⏱️ ${s.duration_minutes} minutes
✨ +${s.points_earned} points bonus après avoir joué`,()=>L(s))},L=async s=>{try{_(!0),b.loading("Échange en cours (sécurisé)...");const n=`reward-${s.id}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o=await fetch(`${j}/transactions/secure_purchase.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reward_id:s.reward_id,idempotency_key:n})});console.log("Response status:",o.status);const f=o.headers.get("content-type");console.log("Content-Type:",f);let a;try{const i=await o.text();console.log("Raw response:",i),a=JSON.parse(i)}catch(i){console.error("Parse error:",i),b.dismiss(),h("Erreur Serveur","Le serveur a renvoyé une réponse invalide. Vérifiez les logs PHP pour plus de détails.");return}if(b.dismiss(),a.success){const i=a.already_processed;T(i?"✅ Déjà Traité":"✅ Échange Réussi !",(i?`🔒 Cette transaction a déjà été effectuée (protection activée)

`:"")+`🎮 ${a.game_name||s.game_name}
⏱️ ${a.duration_minutes||s.duration_minutes} minutes
💸 Points dépensés: ${a.points_spent||s.points_cost}
💰 Nouveau solde: ${a.new_balance} points
🆔 Achat #${a.purchase_id}`),await v(),setTimeout(()=>t("/player/my-purchases"),1500)}else{const i=a.safe!==!1;h("Échange Impossible",`${a.message||a.error||"Une erreur s'est produite."}

`+(i?"✅ Vos points sont en sécurité (aucun débit effectué)":"")+(a.can_retry?`

🔄 Vous pouvez réessayer`:""))}}catch(n){console.error("Erreur complète:",n),b.dismiss(),h("Erreur Réseau",`Impossible de contacter le serveur.

Détails: ${n.message}`)}finally{_(!1),C(null)}},N=d.filter(s=>p==="all"?!0:p==="affordable"?s.points_cost<=c:p==="featured"?s.is_featured:p==="vr"?s.game_category==="vr":!0),z=s=>({sports:"⚽",action:"🎯",racing:"🏎️",vr:"🥽",fighting:"🥊",adventure:"🗺️",rpg:"⚔️",strategy:"♟️"})[s]||"🎮";return P?e.jsx(r,{className:"min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 p-6 flex items-center justify-center",renderId:"render-6a5d7022",as:"div",children:e.jsx(r,{className:"text-white text-xl",renderId:"render-86453e25",as:"div",children:"⏳ Chargement des récompenses..."})}):e.jsxs(r,{className:"min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 p-6",renderId:"render-49d27fcb",as:"div",children:[e.jsxs(r,{className:"max-w-7xl mx-auto",renderId:"render-b5d97482",as:"div",children:[e.jsxs(r,{className:"mb-8",renderId:"render-e4a7b5ba",as:"div",children:[e.jsxs(r,{className:"flex items-center justify-between mb-4",renderId:"render-dd25dad7",as:"div",children:[e.jsxs(r,{renderId:"render-c04410bd",as:"div",children:[e.jsxs(r,{className:"text-4xl font-bold text-white mb-2 flex items-center gap-3",renderId:"render-c6edc050",as:"h1",children:[e.jsx(r,{className:"text-5xl",renderId:"render-ea7f282b",as:"span",children:"🎁"}),"Récompenses & Packages"]}),e.jsx(r,{className:"text-purple-200 text-lg",renderId:"render-bae6180c",as:"p",children:"Échangez vos points contre du temps de jeu !"})]}),e.jsx(r,{onClick:()=>t(-1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl transition-all",renderId:"render-9ccb2131",as:"button",children:"← Retour"})]}),e.jsxs(r,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 shadow-2xl",renderId:"render-e1e7fd2d",as:"div",children:[e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-834611c2",as:"div",children:[e.jsxs(r,{renderId:"render-81dcab65",as:"div",children:[e.jsx(r,{className:"text-yellow-900 font-semibold mb-1",renderId:"render-7b5df9a0",as:"p",children:"Vos Points"}),e.jsx(r,{className:"text-5xl font-bold text-white",renderId:"render-2fb3759d",as:"p",children:c.toLocaleString()})]}),e.jsx(r,{className:"text-7xl",renderId:"render-3d213311",as:"div",children:"⭐"})]}),e.jsxs(r,{className:"mt-4 flex gap-2",renderId:"render-79d025e8",as:"div",children:[e.jsx(r,{onClick:()=>t("/player/gamification"),className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg text-sm transition-all",renderId:"render-73e98445",as:"button",children:"📊 Historique"}),e.jsx(r,{onClick:()=>t("/player/progression"),className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg text-sm transition-all",renderId:"render-3e0f8e3f",as:"button",children:"📈 Progression"})]})]})]}),e.jsx(r,{className:"mb-6 flex gap-3 flex-wrap",renderId:"render-82ff5d18",as:"div",children:[{id:"all",label:"🎮 Tous",icon:""},{id:"affordable",label:"💰 Accessible",icon:""},{id:"featured",label:"⭐ En vedette",icon:""},{id:"vr",label:"🥽 VR",icon:""}].map(s=>e.jsx(r,{onClick:()=>$(s.id),className:`px-6 py-3 rounded-xl font-semibold transition-all ${p===s.id?"bg-white text-purple-900 shadow-lg scale-105":"bg-white/10 text-white hover:bg-white/20"}`,renderId:"render-04aa51d3",as:"button",children:s.label},s.id))}),e.jsxs(r,{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",renderId:"render-c3bf5e09",as:"div",children:[e.jsx(r,{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-white",renderId:"render-ed421ea7",as:"div",children:e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-fb78ef2e",as:"div",children:[e.jsxs(r,{renderId:"render-905b3d5a",as:"div",children:[e.jsx(r,{className:"text-white/70 text-sm",renderId:"render-d0c606e9",as:"p",children:"Packages disponibles"}),e.jsx(r,{className:"text-3xl font-bold",renderId:"render-ebfdf911",as:"p",children:d.length})]}),e.jsx(r,{className:"text-4xl",renderId:"render-e9421660",as:"div",children:"🎁"})]})}),e.jsx(r,{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-white",renderId:"render-d9fb9bf8",as:"div",children:e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-def9c288",as:"div",children:[e.jsxs(r,{renderId:"render-4c83921c",as:"div",children:[e.jsx(r,{className:"text-white/70 text-sm",renderId:"render-d9efc101",as:"p",children:"Packages accessibles"}),e.jsx(r,{className:"text-3xl font-bold",renderId:"render-8e948d2b",as:"p",children:d.filter(s=>s.points_cost<=c).length})]}),e.jsx(r,{className:"text-4xl",renderId:"render-4d90a587",as:"div",children:"✅"})]})}),e.jsx(r,{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-white",renderId:"render-4cea889f",as:"div",children:e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-065c3a25",as:"div",children:[e.jsxs(r,{renderId:"render-a75de92f",as:"div",children:[e.jsx(r,{className:"text-white/70 text-sm",renderId:"render-88366ee4",as:"p",children:"Mes échanges"}),e.jsx(r,{className:"text-3xl font-bold",renderId:"render-6e51b0a0",as:"p",children:d.reduce((s,n)=>s+(n.user_purchases_count||0),0)})]}),e.jsx(r,{className:"text-4xl",renderId:"render-1f513610",as:"div",children:"🏆"})]})})]}),N.length===0?e.jsxs(r,{className:"bg-white/10 backdrop-blur rounded-2xl p-12 text-center text-white",renderId:"render-5750ea2d",as:"div",children:[e.jsx(r,{className:"text-6xl mb-4",renderId:"render-edede9b1",as:"div",children:"😕"}),e.jsx(r,{className:"text-2xl font-bold mb-2",renderId:"render-b86002e6",as:"h3",children:"Aucune récompense disponible"}),e.jsx(r,{className:"text-white/70",renderId:"render-be281e6e",as:"p",children:p==="affordable"?"Vous n'avez pas assez de points pour les packages disponibles. Jouez pour gagner plus de points !":"Revenez plus tard pour découvrir de nouvelles récompenses !"})]}):e.jsx(r,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",renderId:"render-9bbda6c7",as:"div",children:N.map(s=>{const n=c>=s.points_cost,o=s.max_purchases_per_user&&s.user_purchases_count>=s.max_purchases_per_user,f=O(s.game_image,s.game_slug),a=X(f);return e.jsxs(r,{className:`bg-white rounded-2xl shadow-2xl overflow-hidden transform transition-all hover:scale-105 ${!n||o?"opacity-60":""}`,renderId:"render-8c8cfa1c",as:"div",children:[e.jsxs(r,{className:`h-48 relative flex items-center justify-center ${a?`bg-gradient-to-br ${M(f)}`:"bg-gradient-to-br from-purple-500 to-pink-500"}`,style:a?void 0:{backgroundImage:`linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url(${f})`,backgroundSize:"cover",backgroundPosition:"center"},renderId:"render-cbf6710f",as:"div",children:[e.jsxs(r,{className:"text-center",renderId:"render-ae831332",as:"div",children:[e.jsx(r,{className:"text-6xl mb-2",renderId:"render-33191278",as:"div",children:z(s.game_category)}),e.jsx(r,{className:"text-2xl font-bold text-white",renderId:"render-30e1329f",as:"h3",children:s.game_name})]}),s.is_featured&&e.jsx(r,{className:"absolute top-4 right-4 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-bold",renderId:"render-7f4dd026",as:"div",children:"⭐ Vedette"}),s.is_promotional&&s.promotional_label&&e.jsxs(r,{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",renderId:"render-c1b2e38a",as:"div",children:["🔥 ",s.promotional_label]})]}),e.jsxs(r,{className:"p-6",renderId:"render-dfbcfcd7",as:"div",children:[e.jsx(r,{className:"text-xl font-bold text-gray-900 mb-3",renderId:"render-6695806a",as:"h4",children:s.reward_name||s.package_name}),s.reward_description&&e.jsx(r,{className:"text-gray-600 text-sm mb-4 line-clamp-2",renderId:"render-9e416ee4",as:"p",children:s.reward_description}),e.jsxs(r,{className:"flex items-center gap-2 mb-3 text-xs text-gray-500",renderId:"render-e46bec40",as:"div",children:[e.jsxs(r,{className:"inline-flex items-center gap-1",renderId:"render-ae354290",as:"span",children:[e.jsx(r,{renderId:"render-95bc0246",as:"span",children:"🎮"}),e.jsx(r,{className:"font-medium",renderId:"render-140577aa",as:"span",children:s.game_name})]}),s.game_category&&e.jsx(r,{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded-full",renderId:"render-f2917344",as:"span",children:s.game_category})]}),e.jsxs(r,{className:"space-y-2 mb-4",renderId:"render-68cfc371",as:"div",children:[e.jsxs(r,{className:"flex items-center justify-between text-sm",renderId:"render-18ffaf44",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-1797b71f",as:"span",children:"⏱️ Durée"}),e.jsxs(r,{className:"font-semibold text-gray-900",renderId:"render-ca09e8d5",as:"span",children:[s.duration_minutes," minutes"]})]}),e.jsxs(r,{className:"flex items-center justify-between text-sm",renderId:"render-de86152f",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-b31229b6",as:"span",children:"✨ Points bonus"}),e.jsxs(r,{className:"font-semibold text-green-600",renderId:"render-53f90423",as:"span",children:["+",s.points_earned," pts"]})]}),s.bonus_multiplier>1&&e.jsxs(r,{className:"flex items-center justify-between text-sm",renderId:"render-54c88c6e",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-5f83ead0",as:"span",children:"🚀 Multiplicateur"}),e.jsxs(r,{className:"font-semibold text-purple-600",renderId:"render-fd596146",as:"span",children:["×",s.bonus_multiplier]})]}),s.user_purchases_count>0&&e.jsxs(r,{className:"flex items-center justify-between text-sm",renderId:"render-0fc3afa0",as:"div",children:[e.jsx(r,{className:"text-gray-600",renderId:"render-69f3c455",as:"span",children:"🎯 Vos échanges"}),e.jsxs(r,{className:"font-semibold text-blue-600",renderId:"render-5ef559ef",as:"span",children:[s.user_purchases_count,s.max_purchases_per_user?` / ${s.max_purchases_per_user}`:""]})]})]}),e.jsxs(r,{className:"flex items-center justify-between pt-4 border-t border-gray-200",renderId:"render-87c205ae",as:"div",children:[e.jsxs(r,{renderId:"render-a464706e",as:"div",children:[e.jsx(r,{className:"text-gray-600 text-sm",renderId:"render-6c8ec4fa",as:"p",children:"Coût"}),e.jsxs(r,{className:"text-3xl font-bold text-purple-600",renderId:"render-fb6758e8",as:"p",children:[s.points_cost,e.jsx(r,{className:"text-lg ml-1",renderId:"render-0918ad05",as:"span",children:"pts"})]})]}),e.jsx(r,{onClick:()=>R(s),disabled:!n||o||g,className:`px-6 py-3 rounded-xl font-bold transition-all ${n&&!o&&!g?"bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:shadow-xl hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,renderId:"render-94e5e459",as:"button",children:g?"⏳":o?"🔒 Limite":n?"🎁 Échanger":"❌ Trop cher"})]}),!n&&e.jsxs(r,{className:"text-red-600 text-sm mt-2 text-center",renderId:"render-ffebd12b",as:"p",children:["Il vous manque ",s.points_cost-c," points"]})]})]},s.id)})}),e.jsx(r,{className:"mt-8 bg-blue-500/20 border-2 border-blue-400 rounded-xl p-6 text-white",renderId:"render-13e824be",as:"div",children:e.jsxs(r,{className:"flex items-start gap-4",renderId:"render-c922bdd5",as:"div",children:[e.jsx(r,{className:"text-4xl",renderId:"render-cb098348",as:"div",children:"💡"}),e.jsxs(r,{renderId:"render-93139d59",as:"div",children:[e.jsx(r,{className:"text-xl font-bold mb-2",renderId:"render-43398405",as:"h3",children:"Comment ça marche ?"}),e.jsxs(r,{className:"space-y-1 text-blue-100",renderId:"render-6897ff79",as:"ul",children:[e.jsx(r,{renderId:"render-4d34484a",as:"li",children:"• Accumulez des points en jouant"}),e.jsx(r,{renderId:"render-b076b52b",as:"li",children:"• Échangez vos points contre des packages de jeu"}),e.jsx(r,{renderId:"render-37092a40",as:"li",children:"• Recevez des points bonus après avoir joué !"}),e.jsx(r,{renderId:"render-115f88d3",as:"li",children:"• Profitez de packages promotionnels avec plus d'avantages"})]})]})]})})]}),e.jsx(D,{isOpen:l.isOpen,onClose:A,title:l.title,message:l.message,type:l.type,onConfirm:l.onConfirm,confirmText:l.confirmText,cancelText:l.cancelText,showCancel:l.showCancel})]})}if(typeof window<"u"){const t={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const x=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},t,x),{get(u,d){return d in u?u[d]:void 0},has(){return!0}})}const ie=U(function(x){return e.jsx(K,{children:e.jsx(Y,{...x})})});export{ie as default};

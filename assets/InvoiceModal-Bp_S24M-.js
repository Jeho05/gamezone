import{c}from"./createLucideIcon-BCGXG0XW.js";import{C as r}from"./PolymorphicComponent-CmmJTj6d.js";import{r as o}from"./react-vendor-BXH1ZKCn.js";import{A as _}from"./apiBase-uKT1-15E.js";import{t as x}from"./index-DeIfEMOZ.js";import{j as e}from"./ui-vendor-CptTL0WJ.js";import{X as w}from"./x-BQPNjVqT.js";import{C as b}from"./circle-alert-BXr9mOHk.js";import{Q as C}from"./Navigation-C_UvFhfu.js";import{C as P}from"./clock-BTYTED3i.js";if(typeof window<"u"){const d={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const a=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},d,a),{get(n,s){return s in n?n[s]:void 0},has(){return!0}})}const X=c("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);if(typeof window<"u"){const d={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const a=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},d,a),{get(n,s){return s in n?n[s]:void 0},has(){return!0}})}const A=c("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);if(typeof window<"u"){const d={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const a=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},d,a),{get(n,s){return s in n?n[s]:void 0},has(){return!0}})}const $=c("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);if(typeof window<"u"){const d={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const a=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},d,a),{get(n,s){return s in n?n[s]:void 0},has(){return!0}})}const Y=c("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);if(typeof window<"u"){const d={NEXT_PUBLIC_API_BASE:"https://votre-domaine.infinityfreeapp.com/api",NEXT_PUBLIC_KKIAPAY_PUBLIC_KEY:"072b361d25546db0aee3d69bf07b15331c51e39f",NEXT_PUBLIC_KKIAPAY_SANDBOX:"0"};globalThis.process??={};const a=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},d,a),{get(n,s){return s in n?n[s]:void 0},has(){return!0}})}function M({invoice:d,purchase:a,onClose:n}){const[s,m]=o.useState(null),[I,u]=o.useState(!0),[j,f]=o.useState(!1);o.useEffect(()=>{d?.id&&h()},[d?.id]);const h=async()=>{if(!d?.id){console.log("Attente de la facture...");return}try{u(!0),console.log("Chargement QR pour invoice:",d.id);const t=await fetch(`${_}/invoices/generate_qr.php?invoice_id=${d.id}`,{credentials:"include"});console.log("QR Response status:",t.status);const l=await t.json();if(console.log("QR Data:",l),l.error){console.error("Erreur QR:",l.error),x.error(`Erreur QR: ${l.error}`),m({error:l.error});return}console.log("✅ QR chargé avec succès"),m(l)}catch(t){console.error("Erreur lors du chargement du QR code:",t),x.error(`Erreur: ${t.message}`),m({error:t.message})}finally{u(!1)}},y=()=>{s?.invoice?.validation_code&&(navigator.clipboard.writeText(s.invoice.validation_code),f(!0),x.success("Code copié !"),setTimeout(()=>f(!1),2e3))},N=t=>new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),v=t=>{const l=new Date,g=new Date(t)-l,i=Math.floor(g/(1e3*60*60*24)),p=Math.floor(g%(1e3*60*60*24)/(1e3*60*60));return i>30?`${Math.floor(i/30)} mois`:i>0?`${i} jour${i>1?"s":""}`:p>0?`${p} heure${p>1?"s":""}`:"Bientôt"};return e.jsx(r,{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 backdrop-blur-sm",renderId:"render-85c6d41c",as:"div",children:e.jsxs(r,{className:"bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl",renderId:"render-7aa8b963",as:"div",children:[e.jsx(r,{className:"sticky top-0 bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-t-2xl",renderId:"render-188ad46b",as:"div",children:e.jsxs(r,{className:"flex justify-between items-start",renderId:"render-4f9396fa",as:"div",children:[e.jsxs(r,{renderId:"render-c5907961",as:"div",children:[e.jsx(r,{className:"text-2xl font-bold mb-1",renderId:"render-d370d343",as:"h2",children:d.invoice_number}),e.jsx(r,{className:"text-purple-200 text-sm",renderId:"render-d261a34f",as:"p",children:"Facture de Temps de Jeu"})]}),e.jsx(r,{onClick:n,className:"text-white hover:bg-white/20 p-2 rounded-lg transition-colors",renderId:"render-ca80bbb3",as:"button",children:e.jsx(w,{className:"w-6 h-6"})})]})}),e.jsx(r,{className:"p-6",renderId:"render-58c577d6",as:"div",children:I?e.jsxs(r,{className:"text-center py-12",renderId:"render-71e6e8ab",as:"div",children:[e.jsx(r,{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-600 mb-4",renderId:"render-230005b5",as:"div"}),e.jsx(r,{className:"text-gray-600",renderId:"render-c77b76ff",as:"p",children:"Chargement du QR code..."})]}):s?.error?e.jsxs(r,{className:"text-center py-12",renderId:"render-90127511",as:"div",children:[e.jsx(b,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx(r,{className:"text-xl font-bold text-gray-800 mb-2",renderId:"render-f8bf559c",as:"h3",children:"Erreur"}),e.jsx(r,{className:"text-gray-600 mb-6",renderId:"render-49a718d2",as:"p",children:s.error}),e.jsx(r,{onClick:h,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",renderId:"render-066dced6",as:"button",children:"Réessayer"})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs(r,{className:"bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 mb-6",renderId:"render-2c0d45d4",as:"div",children:[e.jsxs(r,{className:"text-center mb-4",renderId:"render-3437b301",as:"div",children:[e.jsx(C,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx(r,{className:"text-lg font-bold text-gray-800",renderId:"render-4cfd8ebc",as:"h3",children:"Votre Code QR"}),e.jsx(r,{className:"text-sm text-gray-600",renderId:"render-cd2139e0",as:"p",children:"Présentez ce code à la réception"})]}),e.jsx(r,{className:"bg-white rounded-lg p-6 shadow-inner flex justify-center",renderId:"render-9b390989",as:"div",children:e.jsx(r,{src:`https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=${encodeURIComponent(s.qr_text||s.invoice.validation_code)}`,alt:"QR Code",className:"w-[280px] h-[280px]",renderId:"render-d25922ec",as:"img"})})]}),e.jsxs(r,{className:"bg-gray-50 rounded-xl p-4 mb-6",renderId:"render-27b155a0",as:"div",children:[e.jsx(r,{className:"block text-sm font-semibold text-gray-700 mb-2",renderId:"render-b7ab0f37",as:"label",children:"Code de Validation"}),e.jsxs(r,{className:"flex gap-2",renderId:"render-e2147824",as:"div",children:[e.jsx(r,{className:"flex-1 bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg px-4 py-4 font-mono text-2xl font-bold text-center tracking-wider text-purple-700 shadow-inner",renderId:"render-96b315bd",as:"div",children:s.invoice.validation_code}),e.jsx(r,{onClick:y,className:"px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-all flex items-center gap-2 shadow-md hover:shadow-lg",title:"Copier le code",renderId:"render-0c025a66",as:"button",children:j?e.jsx(X,{className:"w-5 h-5"}):e.jsx(A,{className:"w-5 h-5"})})]}),e.jsxs(r,{className:"flex items-center justify-center gap-4 mt-3",renderId:"render-09f28f7b",as:"div",children:[e.jsxs(r,{className:"flex items-center gap-2 text-xs text-gray-600",renderId:"render-c85a91ef",as:"div",children:[e.jsx(r,{className:"w-2 h-2 bg-purple-500 rounded-full",renderId:"render-fb0e731f",as:"div"}),e.jsxs(r,{renderId:"render-c9305bd1",as:"span",children:[s.invoice.validation_code.replace(/-/g,"").length," caractères"]})]}),e.jsxs(r,{className:"flex items-center gap-2 text-xs text-gray-600",renderId:"render-7d4fedb4",as:"div",children:[e.jsx(r,{className:"w-2 h-2 bg-green-500 rounded-full",renderId:"render-bac18430",as:"div"}),e.jsxs(r,{renderId:"render-dcee036d",as:"span",children:["Format: ",s.invoice.validation_code.length>10?"XXXX-XXXX-XXXX-XXXX":"XXXX-XXXX"]})]})]}),e.jsx(r,{className:"text-xs text-purple-600 mt-2 text-center font-medium bg-purple-50 py-2 px-4 rounded-lg border border-purple-200",renderId:"render-9ba06dbe",as:"p",children:"💡 L'admin peut scanner le QR ou taper le code manuellement (avec ou sans tirets)"})]}),e.jsxs(r,{className:"space-y-3 mb-6",renderId:"render-a4e8eb9c",as:"div",children:[e.jsxs(r,{className:"flex justify-between items-center py-2 border-b",renderId:"render-c6bed747",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-6ee3a7f9",as:"span",children:"Jeu:"}),e.jsx(r,{className:"font-bold text-gray-800",renderId:"render-db095505",as:"span",children:d.game_name})]}),d.package_name&&e.jsxs(r,{className:"flex justify-between items-center py-2 border-b",renderId:"render-de5d7ba4",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-e5dc6e04",as:"span",children:"Package:"}),e.jsx(r,{className:"font-bold text-gray-800",renderId:"render-6f16d9f2",as:"span",children:d.package_name})]}),e.jsxs(r,{className:"flex justify-between items-center py-2 border-b",renderId:"render-c87678b1",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-2cb200f1",as:"span",children:"Durée:"}),e.jsxs(r,{className:"font-bold text-purple-600",renderId:"render-e34d5812",as:"span",children:[s.invoice.duration_minutes," minutes"]})]}),e.jsxs(r,{className:"flex justify-between items-center py-2 border-b",renderId:"render-326d28f8",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-d66e7636",as:"span",children:"Montant:"}),e.jsxs(r,{className:"font-bold text-green-600",renderId:"render-7b1b72b6",as:"span",children:[s.invoice.amount," XOF"]})]}),e.jsxs(r,{className:"flex justify-between items-center py-2 border-b",renderId:"render-0f09d8e8",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-af69b771",as:"span",children:"Statut:"}),e.jsx(r,{className:`px-3 py-1 rounded-full text-sm font-semibold ${d.status==="pending"?"bg-yellow-100 text-yellow-700":d.status==="active"?"bg-green-100 text-green-700":d.status==="used"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,renderId:"render-53ef39eb",as:"span",children:d.status==="pending"?"En Attente":d.status==="active"?"Active":d.status==="used"?"Utilisée":d.status})]}),e.jsxs(r,{className:"flex justify-between items-center py-2",renderId:"render-547d0862",as:"div",children:[e.jsx(r,{className:"text-gray-600 font-medium",renderId:"render-803619c6",as:"span",children:"Expire:"}),e.jsx(r,{className:"font-bold text-gray-800",renderId:"render-f751f2b1",as:"span",children:N(s.invoice.expires_at)})]})]}),e.jsx(r,{className:"bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4",renderId:"render-19743ca4",as:"div",children:e.jsxs(r,{className:"flex items-start gap-3",renderId:"render-5aefb1d9",as:"div",children:[e.jsx(P,{className:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs(r,{className:"text-sm",renderId:"render-045d50b6",as:"div",children:[e.jsxs(r,{className:"font-bold text-yellow-800 mb-1",renderId:"render-46fbd0f8",as:"p",children:["⏰ Expire dans ",v(s.invoice.expires_at)]}),e.jsxs(r,{className:"text-yellow-700",renderId:"render-77dd8702",as:"p",children:["Présentez cette facture à la réception avant le ",new Date(s.invoice.expires_at).toLocaleDateString("fr-FR"),". Après cette date, elle ne sera plus utilisable."]})]})]})}),e.jsx(r,{className:"mt-6 bg-blue-50 border-2 border-blue-200 rounded-lg p-4",renderId:"render-77f4d49f",as:"div",children:e.jsxs(r,{className:"flex items-start gap-3",renderId:"render-e25f95c5",as:"div",children:[e.jsx(b,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs(r,{className:"text-sm text-blue-800",renderId:"render-637538d9",as:"div",children:[e.jsx(r,{className:"font-bold mb-2",renderId:"render-77243118",as:"p",children:"Comment utiliser cette facture ?"}),e.jsxs(r,{className:"space-y-1 text-xs list-decimal list-inside",renderId:"render-0719c92a",as:"ol",children:[e.jsx(r,{renderId:"render-db8a26bb",as:"li",children:"Présentez le QR code ou le code alphanumérique à la réception"}),e.jsx(r,{renderId:"render-bf2102e0",as:"li",children:"L'administrateur scannera votre code"}),e.jsx(r,{renderId:"render-1799f696",as:"li",children:"Votre session sera activée automatiquement"}),e.jsx(r,{renderId:"render-4f82f8e8",as:"li",children:"Le temps commencera à se décompter"}),e.jsx(r,{renderId:"render-402c0153",as:"li",children:"Profitez de votre jeu !"})]})]})]})})]}):e.jsxs(r,{className:"text-center py-8",renderId:"render-fb814436",as:"div",children:[e.jsx(b,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx(r,{className:"text-gray-600",renderId:"render-d4c94ab6",as:"p",children:"Impossible de charger le QR code"})]})}),e.jsx(r,{className:"sticky bottom-0 bg-gray-50 p-4 rounded-b-2xl border-t",renderId:"render-1875ff65",as:"div",children:e.jsx(r,{onClick:n,className:"w-full py-3 px-6 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all",renderId:"render-4b90d32c",as:"button",children:"Fermer"})})]})})}export{$ as D,M as I,Y as R};
